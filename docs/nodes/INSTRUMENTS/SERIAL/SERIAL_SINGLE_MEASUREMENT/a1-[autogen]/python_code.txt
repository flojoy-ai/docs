from flojoy import flojoy, OrderedPair
from time import sleep
import serial
import numpy as np
from datetime import datetime
import plotly.graph_objects as go


@flojoy
def SERIAL_SINGLE_MEASUREMENT(comport: str = "/dev/ttyUSB0", baudrate: float = 9600.0) -> OrderedPair:
    
    COM_PORT = comport
    BAUD = int(baudrate)

    ser = serial.Serial(COM_PORT, timeout=1, baudrate=BAUD)
    s = ""
    while s == "":
        s = ser.readline().decode()

    reading = s[:-2].split(",")

    reading = np.array(reading)  # Create an array
    reading = reading.astype("float64")  # Convert the array to float
    x = np.arange(0, reading.size)  # Create a second array

    return OrderedPair(x=x, y=reading)


@flojoy
def SERIAL_SINGLE_MEASUREMENT_MOCK() -> OrderedPair:
    print("Running mock version of Serial")

    x = np.linspace(0, 100, 100)
    y = np.linspace(0, 100, 100)

    return OrderedPair(x=x, y=y)
