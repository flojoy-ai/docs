from flojoy import flojoy, DataFrame
from typing import Union
import pandas as pd
from typing import cast


@flojoy
def ONE_HOT_ENCODING(default: DataFrame, categories: list[Union[str, int]], columns: list[str]) -> DataFrame:
    

    if categories:
        data = pd.DataFrame({"category": categories})
        # Force pandas to treat the column as categorical
        data["category"] = data["category"].astype("category")
        encoded = pd.get_dummies(data, dtype=int)
        return DataFrame(m=encoded)

    if columns:
        encoded = pd.get_dummies(default.m[columns])
    else:
        df = cast(pd.DataFrame, default.m)
        cat_df = df.select_dtypes(include=["object", "category"])
        encoded = pd.get_dummies(cat_df, dtype=int)
    return DataFrame(m=encoded)
