from flojoy import flojoy, DataFrame, Defaultparams
from sklearn.datasets import fetch_20newsgroups
from sklearn.utils import Bunch
import pandas as pd
from typing import cast


# TODO: Add more datasets to this node.
@flojoy
def TEXT_DATASET(default_params: Defaultparams) -> DataFrame:
    

    subset = default_params.get("subset", "train")
    categories = default_params.get("categories", None)
    remove_headers = default_params.get("remove_headers", False)
    remove_footers = default_params.get("remove_footers", False)
    remove_quotes = default_params.get("remove_quotes", False)

    to_remove = []
    if remove_headers:
        to_remove.append("headers")
    if remove_footers:
        to_remove.append("footers")
    if remove_quotes:
        to_remove.append("quotes")
    to_remove = tuple(to_remove)

    if categories:
        newsgroups = fetch_20newsgroups(
            subset=subset, categories=categories, remove=to_remove
        )
    else:
        newsgroups = fetch_20newsgroups(subset=subset, remove=to_remove)

    newsgroups = cast(Bunch, newsgroups)
    data = newsgroups.data
    labels = [newsgroups.target_names[i] for i in newsgroups.target]

    df = pd.DataFrame({"Text": data, "Label": labels})
    return DataFrame(m=df)
