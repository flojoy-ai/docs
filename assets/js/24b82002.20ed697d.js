"use strict";(self.webpackChunkflojoy_doc=self.webpackChunkflojoy_doc||[]).push([[30809],{3905:(e,t,o)=>{o.d(t,{Zo:()=>d,kt:()=>m});var n=o(67294);function r(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function a(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function i(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?a(Object(o),!0).forEach((function(t){r(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):a(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function l(e,t){if(null==e)return{};var o,n,r=function(e,t){if(null==e)return{};var o,n,r={},a=Object.keys(e);for(n=0;n<a.length;n++)o=a[n],t.indexOf(o)>=0||(r[o]=e[o]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)o=a[n],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(r[o]=e[o])}return r}var c=n.createContext({}),s=function(e){var t=n.useContext(c),o=t;return e&&(o="function"==typeof e?e(t):i(i({},t),e)),o},d=function(e){var t=s(e.components);return n.createElement(c.Provider,{value:t},e.children)},p="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},h=n.forwardRef((function(e,t){var o=e.components,r=e.mdxType,a=e.originalType,c=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),p=s(o),h=r,m=p["".concat(c,".").concat(h)]||p[h]||u[h]||a;return o?n.createElement(m,i(i({ref:t},d),{},{components:o})):n.createElement(m,i({ref:t},d))}));function m(e,t){var o=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=o.length,i=new Array(a);i[0]=h;var l={};for(var c in t)hasOwnProperty.call(t,c)&&(l[c]=t[c]);l.originalType=e,l[p]="string"==typeof e?e:r,i[1]=l;for(var s=2;s<a;s++)i[s]=o[s];return n.createElement.apply(null,i)}return n.createElement.apply(null,o)}h.displayName="MDXCreateElement"},7127:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>u,frontMatter:()=>a,metadata:()=>l,toc:()=>s});var n=o(87462),r=(o(67294),o(3905));const a={sidebar_position:2,id:"architecture",title:"Architecture"},i=void 0,l={unversionedId:"getting-started/architecture",id:"getting-started/architecture",title:"Architecture",description:"Docker",source:"@site/docs/getting-started/architecture.md",sourceDirName:"getting-started",slug:"/getting-started/architecture",permalink:"/getting-started/architecture",draft:!1,tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2,id:"architecture",title:"Architecture"}},c={},s=[{value:"Docker",id:"docker",level:3},{value:"CI/CD",id:"cicd",level:3},{value:"Data flow",id:"data-flow",level:3}],d={toc:s},p="wrapper";function u(e){let{components:t,...o}=e;return(0,r.kt)(p,(0,n.Z)({},d,o,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("img",{width:"606",alt:"image",src:"https://user-images.githubusercontent.com/1865834/228071258-418c7a14-68a9-4277-ab6b-a798f0889d09.png"}),(0,r.kt)("h3",{id:"docker"},"Docker"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Flojoy uses Docker to containerize the whole backend. Its Docker setup is composed of three files: ",(0,r.kt)("inlineCode",{parentName:"li"},"docker-compose-base.yaml"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"docker-compose-prod.yaml"),", and ",(0,r.kt)("inlineCode",{parentName:"li"},"docker-compose.yaml"),"."),(0,r.kt)("li",{parentName:"ol"},"It has a base image for all the Docker images that only build when something is pushed to the main branch and is pushed to Docker Hub. ",(0,r.kt)("inlineCode",{parentName:"li"},"docker-compose-prod")," is also built when something is pushed to the main branch and also pushed to Docker Hub. ",(0,r.kt)("inlineCode",{parentName:"li"},"docker-compose-prod")," is only used for the Electron app."),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("inlineCode",{parentName:"li"},"docker-compose")," is used to build images on every GitHub CI run as well as when running Docker locally in development mode, which pulls all the images from Docker hub built from ",(0,r.kt)("inlineCode",{parentName:"li"},"docker-compose-base")," as their base image and builds images based on current existing changes.")),(0,r.kt)("h3",{id:"cicd"},"CI/CD"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Flojoy uses a CI/CD pipeline to automate the development, testing, and deployment processes. "),(0,r.kt)("li",{parentName:"ol"},"CI runs on every pull request and code push on the development branch. It builds Docker images from the ",(0,r.kt)("inlineCode",{parentName:"li"},"docker-compose")," file and runs all the unit tests as well as end-to-end tests."),(0,r.kt)("li",{parentName:"ol"},"CD workflow only runs when some codes are pushed to the main branch. It builds Docker images from ",(0,r.kt)("inlineCode",{parentName:"li"},"docker-compose-base")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"docker-compose-prod")," as well. It also builds Electron distributions when a tag is pushed to the main branch.")),(0,r.kt)("h3",{id:"data-flow"},"Data flow"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Flojoy is a single-page React app that hinges on the ",(0,r.kt)("a",{parentName:"li",href:"https://reactflow.dev/"},"https://reactflow.dev/")," open-source library. Creating the Flow Chart and control dashboard is done entirely in JavaScript (React), without any interaction with a backend service."),(0,r.kt)("li",{parentName:"ol"},"React Flow serializes flow chart layout and metadata as JSON. When an app user clicks on the play button, the Front-End sends node metadata to Django, which processes that JSON data and enqueues a watchdog function to the rq worker."),(0,r.kt)("li",{parentName:"ol"},"Flojoy has two primary rq workers: ",(0,r.kt)("inlineCode",{parentName:"li"},"flojoy-watch")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"flojoy"),". Where ",(0,r.kt)("inlineCode",{parentName:"li"},"flojoy-watch")," runs the watchdog function, and the other one is for nodes. Django enqueues watchdog to the watch rq worker, and eventually, rq worker executes that watchdog function."),(0,r.kt)("li",{parentName:"ol"},"The watchdog function then processes further and enqueues nodes to corresponding rq worker in respect to their execution order. "),(0,r.kt)("li",{parentName:"ol"},"Flojoy has its own python library ",(0,r.kt)("a",{parentName:"li",href:"https://pypi.org/project/flojoy/"},"flojoy")," which exports a decorator function to wrap all the node functions. Rq workers, watchdog, and the decorator all of them communicate with Django with HTTP POST requests on an API."),(0,r.kt)("li",{parentName:"ol"},"Django receives these requests and communicates with Front-End with a socket connection to provide real-time data. "),(0,r.kt)("li",{parentName:"ol"},"The decorator processes node metadata and prepares all the parameters of the node and looks for any dependency on another node. If the current node depends on other nodes, then it fetches their results from the rq worker and finally calls the node function with its parameter values and dependent node results."),(0,r.kt)("li",{parentName:"ol"},"After the node function runs, the decorator collects its result and sends it to Django with a POST API call, which eventually sends them to FE through a socket connection.")))}u.isMDXComponent=!0}}]);