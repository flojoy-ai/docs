"use strict";(self.webpackChunkflojoy_doc=self.webpackChunkflojoy_doc||[]).push([[81346],{3905:(e,t,a)=>{a.d(t,{Zo:()=>d,kt:()=>y});var n=a(67294);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,o=function(e,t){if(null==e)return{};var a,n,o={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(o[a]=e[a]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}var m=n.createContext({}),s=function(e){var t=n.useContext(m),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},d=function(e){var t=s(e.components);return n.createElement(m.Provider,{value:t},e.children)},p="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var a=e.components,o=e.mdxType,r=e.originalType,m=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),p=s(a),u=o,y=p["".concat(m,".").concat(u)]||p[u]||c[u]||r;return a?n.createElement(y,i(i({ref:t},d),{},{components:a})):n.createElement(y,i({ref:t},d))}));function y(e,t){var a=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=a.length,i=new Array(r);i[0]=u;var l={};for(var m in t)hasOwnProperty.call(t,m)&&(l[m]=t[m]);l.originalType=e,l[p]="string"==typeof e?e:o,i[1]=l;for(var s=2;s<r;s++)i[s]=a[s];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}u.displayName="MDXCreateElement"},11406:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>m,contentTitle:()=>i,default:()=>c,frontMatter:()=>r,metadata:()=>l,toc:()=>s});var n=a(87462),o=(a(67294),a(3905));const r={sidebar_position:1,id:"small-memory",title:"The SmallMemory class"},i=void 0,l={unversionedId:"advanced-usage/small-memory",id:"advanced-usage/small-memory",title:"The SmallMemory class",description:"There are instances where a custom node will need to store complicated data such that future iterations of the node, or perhaps another external node, will be able to access it, even if no direct connections are made in Flojoy. This might be because, while in a loop, a node may be able to make smart decisions about what its future output may be given the history of another node, for example a measurement made in real time.",source:"@site/docs/advanced-usage/small-memory.md",sourceDirName:"advanced-usage",slug:"/advanced-usage/small-memory",permalink:"/advanced-usage/small-memory",draft:!1,tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1,id:"small-memory",title:"The SmallMemory class"},sidebar:"main",previous:{title:"flojoy Python Library",permalink:"/advanced-usage/flojoy-python-library"},next:{title:"Active feedback loop",permalink:"/advanced-usage/feedback-control/active-feedback"}},m={},s=[{value:"Writing data to memory",id:"writing-data-to-memory",level:3},{value:"Reading data from memory",id:"reading-data-from-memory",level:3}],d={toc:s},p="wrapper";function c(e){let{components:t,...a}=e;return(0,o.kt)(p,(0,n.Z)({},d,a,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"There are instances where a custom node will need to store complicated data such that future iterations of the node, or perhaps another external node, will be able to access it, even if no direct connections are made in Flojoy. This might be because, while in a loop, a node may be able to make smart decisions about what its future output may be given the history of another node, for example a measurement made in real time."),(0,o.kt)("p",null,"To this aim, we have implemented the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/flojoy-io/studio/blob/main/PYTHON/node_sdk/small_memory.py"},(0,o.kt)("inlineCode",{parentName:"a"},"SmallMemory"))," class in ",(0,o.kt)("inlineCode",{parentName:"p"},"flojoy-python"),". It is a helper API that is geared to allowing developers to store custom data in Redis such that it can be easily accessed later in the execution of the app. The most common robust datatype that requires storage is usually ",(0,o.kt)("inlineCode",{parentName:"p"},"NumPy")," arrays. However, the ",(0,o.kt)("inlineCode",{parentName:"p"},"SmallMemory")," class is capable of the reading and writing of many data types from Redis."),(0,o.kt)("p",null,"To use the ",(0,o.kt)("inlineCode",{parentName:"p"},"SmallMemory")," class, we simply import it in the header of our custom node via:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},"from node_sdk.small_memory import SmallMemory\n")),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("p",{parentName:"admonition"},"Flojoy automatically garbage collects all data that is stored at the end of a job, so the user need only concern themselves with the reading and writing of the data (how very Python!)")),(0,o.kt)("h3",{id:"writing-data-to-memory"},"Writing data to memory"),(0,o.kt)("p",null,"The API needs a few parameters to be able to store data internally."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"node_id"),": the node ID is required at runtime to be able to identify a specific pointer to memory as being associated with this particular instance of a given node (to avoid confusion if multiple instances of the same node type are in the app).")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"memory_key"),": the memory key is a string passed to Redis to be able to recognize the type of node that accessed this data. The convention we have adopted is that the memory key is the name of the function in the node (as defined in the Python file). This allows for easy parsing in other nodes during development.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"data"),": this is, understandably, the data to be stored. There are multiple datatypes that can be stored with the ",(0,o.kt)("inlineCode",{parentName:"p"},"SmallMemory")," class."),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"NumPy")," arrays"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"pandas")," dataframes"),(0,o.kt)("li",{parentName:"ul"},"strings"),(0,o.kt)("li",{parentName:"ul"},"dictionaries")))),(0,o.kt)("p",null,"In Flojoy, we can access to node id with passing ",(0,o.kt)("inlineCode",{parentName:"p"},"inject_node_metadata=True")," to ",(0,o.kt)("inlineCode",{parentName:"p"},"flojoy")," decorator and adding a parameter with ",(0,o.kt)("inlineCode",{parentName:"p"},"DefaultParams")," class type annotation like below:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},"from flojoy import flojoy, DefaultParams\n\n@flojoy(inject_node_metadata=True)\ndef Node(..., default_params: DefaultParams):\n    ...\n")),(0,o.kt)("p",null,"Then we can easily access to node id as following"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},"node_id = default_params.node_id\n")),(0,o.kt)("p",null,"Know more about ",(0,o.kt)("a",{parentName:"p",href:"/custom-nodes/node-api-reference#defaultparams"},(0,o.kt)("inlineCode",{parentName:"a"},"DefaultParams"))),(0,o.kt)("p",null,"and the memory key for that given function is usually defined in the header of the Python file for that node. To then write data to memory, we simply instantiate the API and call the appropriate method:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},"SmallMemory().write_to_memory(node_id, memory_key, data)\n")),(0,o.kt)("h3",{id:"reading-data-from-memory"},"Reading data from memory"),(0,o.kt)("p",null,"In a very likewise fashion, we can read data in from redis with the following syntax:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},"data = SmallMemory().read_memory(node_id, memory_key)\n")),(0,o.kt)("p",null,"If no data has been written to this store with the given ID and key, then this method will return an empty dictionary ",(0,o.kt)("inlineCode",{parentName:"p"},"{}")," (for example, at the first iteration of the node)."),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("p",{parentName:"admonition"},"Empty dictionaries evaluate to ",(0,o.kt)("inlineCode",{parentName:"p"},"False")," in Python, so you can easily check if ",(0,o.kt)("inlineCode",{parentName:"p"},"SmallMemory")," returned anything real. ")))}c.isMDXComponent=!0}}]);